<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Amis</title>
<style>
    body {
        margin: 0;
        font-family: Arial;
        display: flex;
        height: 100vh;
    }

    #users, #requests, #friends {
        flex: 1;
        border-right: 2px solid #ddd;
        padding: 20px;
        overflow-y: auto;
    }

    .user-card {
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }

    button {
        padding: 5px 10px;
        margin-top: 8px;
    }
</style>
</head>
<body>

<div id="users">
    <h2>√âtudiants</h2>
    <div id="users-list"></div>
</div>

<div id="requests">
    <h2>Demandes re√ßues</h2>
    <div id="requests-list"></div>
</div>

<div id="friends">
    <h2>Mes amis</h2>
    <div id="friends-list"></div>
</div>

<script>

// üßë ID de l'√©tudiant connect√© (temporaire, doit venir de ton login)
const ME = "1";

let allUsers = [];

// Charger tous les utilisateurs
async function loadUsers() {
    const res = await fetch('/api/ami');
    allUsers = await res.json();

    renderUsers();
    renderFriends();
    renderRequests();
}

function renderUsers() {
    const box = document.getElementById("users-list");
    box.innerHTML = "";

    allUsers.forEach(u => {
        if (u.id === ME) return;

        const div = document.createElement('div');
        div.className = "user-card";
        div.innerHTML = `
            <strong>${u.name}</strong><br>
            <button onclick="addFriend('${u.id}')">Ajouter ami</button>
        `;
        box.appendChild(div);
    });
}

function renderRequests() {
    const me = allUsers.find(u => u.id === ME);
    const box = document.getElementById("requests-list");

    box.innerHTML = "";

    me.requests.forEach(id => {
        const u = allUsers.find(x => x.id === id);

        const div = document.createElement('div');
        div.className = "user-card";
        div.innerHTML = `
            <strong>${u.name}</strong><br>
            <button onclick="accept('${u.id}')">Accepter</button>
        `;
        box.appendChild(div);
    });
}

function renderFriends() {
    const me = allUsers.find(u => u.id === ME);
    const box = document.getElementById("friends-list");

    box.innerHTML = "";

    me.friends.forEach(id => {
        const u = allUsers.find(x => x.id === id);

        const div = document.createElement('div');
        div.className = "user-card";
        div.innerHTML = `
            <strong>${u.name}</strong><br>
            <button onclick="removeFriend('${u.id}')">Retirer</button>
        `;
        box.appendChild(div);
    });
}

// ‚û§ Ajouter un ami
async function addFriend(toId) {
    await fetch('/api/ami/add', {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ fromId: ME, toId })
    });

    loadUsers();
}

// ‚û§ Accepter demande
async function accept(fromId) {
    await fetch('/api/ami/accept', {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ userId: ME, fromId })
    });

    loadUsers();
}

// ‚û§ Retirer ami
async function removeFriend(friendId) {
    await fetch('/api/ami/remove', {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ userId: ME, friendId })
    });

    loadUsers();
}

loadUsers();

</script>
</body>
</html>
