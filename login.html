<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>MiniR√©seau ‚Äì Connexion / Inscription</title>
	<style>
		:root {
			--bg: #0f1720;
			--card: #0b1220;
			--muted: #9aa4b2;
			--accent: #0b84ff;
			--danger: #f97373;
		}

		* { box-sizing: border-box; }

		html, body {
			margin: 0;
			padding: 0;
			min-height: 100vh;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
			color: #e5e7eb;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.shell {
			width: 100%;
			max-width: 980px;
			display: grid;
			grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
			gap: 32px;
			padding: 32px 20px;
		}

		.hero {
			padding: 28px 24px;
			border-radius: 18px;
			background: linear-gradient(145deg, rgba(15,23,42,0.95), rgba(15,23,42,0.7));
			border: 1px solid rgba(148,163,184,0.3);
			box-shadow: 0 18px 45px rgba(15,23,42,0.9);
		}

		.badge {
			display: inline-flex;
			align-items: center;
			gap: 6px;
			font-size: 11px;
			padding: 4px 10px;
			border-radius: 999px;
			background: rgba(56,189,248,0.16);
			color: #7dd3fc;
			border: 1px solid rgba(56,189,248,0.45);
			margin-bottom: 14px;
		}

		.title {
			font-size: 28px;
			line-height: 1.2;
			margin: 0 0 8px 0;
		}

		.subtitle {
			font-size: 13px;
			color: var(--muted);
			max-width: 360px;
		}

		.hero-metrics {
			display: flex;
			gap: 16px;
			margin-top: 18px;
			font-size: 11px;
			color: var(--muted);
		}

		.metric {
			padding: 8px 10px;
			border-radius: 10px;
			background: rgba(15,23,42,0.9);
			border: 1px solid rgba(148,163,184,0.3);
		}

		.metric strong { display: block; font-size: 13px; color: #e5e7eb; }

		.auth-card {
			padding: 24px 22px 20px;
			border-radius: 18px;
			background: rgba(15,23,42,0.98);
			border: 1px solid rgba(148,163,184,0.35);
			box-shadow: 0 18px 45px rgba(15,23,42,0.85);
		}

		h2 {
			margin: 0 0 8px 0;
			font-size: 22px;
		}

		.muted { color: var(--muted); font-size: 12px; }

		.tabs {
			display: inline-flex;
			background: rgba(15,23,42,0.9);
			border-radius: 999px;
			border: 1px solid rgba(148,163,184,0.4);
			padding: 3px;
			margin: 14px 0 18px;
		}

		.tab-btn {
			border: none;
			background: transparent;
			color: var(--muted);
			font-size: 11px;
			padding: 6px 14px;
			border-radius: 999px;
			cursor: pointer;
			transition: 0.15s;
		}

		.tab-btn.active {
			background: #0b84ff;
			color: #e5e7eb;
			box-shadow: 0 8px 25px rgba(37, 99, 235, 0.55);
		}

		form { margin-top: 4px; }

		.field { margin-bottom: 12px; }

		label {
			display: block;
			font-size: 11px;
			text-transform: uppercase;
			letter-spacing: 0.04em;
			color: var(--muted);
			margin-bottom: 4px;
		}

		input[type="email"],
		input[type="password"],
		input[type="text"] {
			width: 100%;
			padding: 8px 10px;
			border-radius: 9px;
			border: 1px solid rgba(148,163,184,0.5);
			background: rgba(15,23,42,0.95);
			color: #e5e7eb;
			font-size: 13px;
		}

		input:focus {
			outline: none;
			border-color: #0b84ff;
			box-shadow: 0 0 0 1px rgba(59,130,246,0.5);
		}

		.btn-primary {
			width: 100%;
			border: none;
			margin-top: 10px;
			padding: 9px 12px;
			border-radius: 999px;
			background: linear-gradient(135deg, #0b84ff, #2563eb);
			color: white;
			font-size: 13px;
			font-weight: 600;
			cursor: pointer;
			box-shadow: 0 12px 35px rgba(37,99,235,0.6);
			transition: transform 0.12s ease, box-shadow 0.12s ease;
		}

		.btn-primary:hover {
			transform: translateY(-1px);
			box-shadow: 0 16px 45px rgba(37,99,235,0.75);
		}

		.link-btn {
			background: none;
			border: none;
			color: #93c5fd;
			font-size: 12px;
			cursor: pointer;
			padding: 0;
		}

		.link-btn:hover { text-decoration: underline; }

		.error {
			margin-top: 6px;
			font-size: 11px;
			color: var(--danger);
			min-height: 14px;
		}

		@media (max-width: 840px) {
			.shell {
				grid-template-columns: minmax(0, 1fr);
				max-width: 480px;
			}
			.hero { display: none; }
		}
	</style>
</head>
<body>
	<div class="shell">
		<section class="hero">
			<div class="badge">MiniR√©seau ¬∑ Espace √âtudiants</div>
			<h1 class="title">Retrouve ton campus, en ligne.</h1>
			<p class="subtitle">Discute avec ta promo, partage des ressources et organise tes projets en quelques clics.</p>

			<div class="hero-metrics">
				<div class="metric">
					<strong>Fil d'actualit√©</strong>
					<span>Publie et commente les actualit√©s de la promo.</span>
				</div>
				<div class="metric">
					<strong>Messagerie</strong>
					<span>Groupes de travail, √©v√©nements, documents partag√©s.</span>
				</div>
			</div>
		</section>

		<section class="auth-card">
			<h2>Connexion</h2>
			<p class="muted">Entre sur MiniR√©seau avec ton mail √©tudiant.</p>

			<div class="tabs">
				<button id="tab-login" class="tab-btn active" type="button" onclick="switchForm('login');activateTab('login')">Se connecter</button>
				<button id="tab-register" class="tab-btn" type="button" onclick="switchForm('register');activateTab('register')">Cr√©er un compte</button>
			</div>

			<!-- R√¥les visibles et privil√®ges -->
			<div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;margin-bottom:12px;font-size:11px;">
				<div style="border-radius:10px;padding:8px 9px;background:rgba(15,23,42,0.96);border:1px solid rgba(148,163,184,0.35);">
					<div style="font-weight:600;margin-bottom:2px;">üë®‚Äçüéì √âtudiant</div>
					<div style="color:var(--muted);">
						Fil d'actualit√©, messagerie de promo, constellation et profil.
					</div>
				</div>
				<div style="border-radius:10px;padding:8px 9px;background:rgba(15,23,42,0.96);border:1px solid rgba(148,163,184,0.35);">
					<div style="font-weight:600;margin-bottom:2px;">üë®‚Äçüè´ Enseignant</div>
					<div style="color:var(--muted);">
						Acc√®s d√©di√© pour suivre les groupes, publier des annonces de cours.
					</div>
				</div>
				<div style="border-radius:10px;padding:8px 9px;background:rgba(15,23,42,0.96);border:1px solid rgba(148,163,184,0.35);">
					<div style="font-weight:600;margin-bottom:2px;">üëî Personnel</div>
					<div style="color:var(--muted);">
						Vue campus, messagerie institutionnelle et futurs outils de suivi.
					</div>
				</div>
			</div>

			<!-- Formulaire de connexion -->
			<form id="loginForm" onsubmit="event.preventDefault(); login();">
				<div class="field">
					<label for="loginEmail">Email</label>
					<input type="email" id="loginEmail" placeholder="prenom.nom@exemple.fr" required />
				</div>
				<div class="field">
					<label for="loginPassword">Mot de passe</label>
					<input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
				</div>
				<button class="btn-primary" type="submit">Se connecter</button>
				<div id="loginError" class="error"></div>
			</form>

			<!-- Formulaire d'inscription -->
			<form id="registerForm" style="display:none" onsubmit="event.preventDefault(); register();">
				<div class="field">
					<label for="regName">Nom</label>
					<input type="text" id="regName" placeholder="Nom" required />
				</div>
				<div class="field">
					<label for="regPrenom">Pr√©nom</label>
					<input type="text" id="regPrenom" placeholder="Pr√©nom" required />
				</div>
				<div class="field">
					<label for="regRole">R√¥le dans l'√©cole</label>
					<select id="regRole" style="width:100%;padding:8px 10px;border-radius:9px;border:1px solid rgba(148,163,184,0.5);background:rgba(15,23,42,0.95);color:#e5e7eb;font-size:13px;">
						<option value="eleve">√âtudiant</option>
						<option value="enseignant">Enseignant</option>
						<option value="personnel">Personnel de l'√©cole</option>
					</select>
				</div>
				<div class="field" id="fieldClasse">
					<label for="regClasse">Classe (si √©tudiant)</label>
					<select id="regClasse" style="width:100%;padding:8px 10px;border-radius:9px;border:1px solid rgba(148,163,184,0.5);background:rgba(15,23,42,0.95);color:#e5e7eb;font-size:13px;">
						<option value="">S√©lectionne ta classe‚Ä¶</option>
					</select>
				</div>
				<div class="field">
					<label for="regEmail">Email</label>
					<input type="email" id="regEmail" placeholder="prenom.nom@exemple.fr" required />
				</div>
				<div class="field">
					<label for="regPassword">Mot de passe</label>
					<input type="password" id="regPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
				</div>
				<button class="btn-primary" type="submit">Cr√©er mon compte</button>
				<div id="registerError" class="error"></div>
			</form>

			<p class="muted" style="margin-top:14px;">
				Tu as d√©j√† un compte ?
				<button class="link-btn" type="button" onclick="switchForm('login');activateTab('login')">Connecte-toi</button>
			</p>
		</section>
	</div>

	<script src="auth.js"></script>
	<script>
		function activateTab(which) {
			const loginTab = document.getElementById('tab-login');
			const registerTab = document.getElementById('tab-register');
			if (!loginTab || !registerTab) return;
			if (which === 'login') {
				loginTab.classList.add('active');
				registerTab.classList.remove('active');
			} else {
				registerTab.classList.add('active');
				loginTab.classList.remove('active');
			}
		}

		document.addEventListener('DOMContentLoaded', () => {
			const roleSelect = document.getElementById('regRole');
			const classeField = document.getElementById('fieldClasse');
			const classeSelect = document.getElementById('regClasse');
			if (!roleSelect || !classeField) return;
			const updateClasseVisibility = () => {
				classeField.style.display = roleSelect.value === 'eleve' ? 'block' : 'none';
			};
			roleSelect.addEventListener('change', updateClasseVisibility);
			updateClasseVisibility();

			// Charger la liste des classes depuis l'API
			if (classeSelect) {
				fetch(window.location.origin + '/api/classes')
					.then(res => res.ok ? res.json() : Promise.reject())
					.then(data => {
						const classes = data.classes || [];
						classes.forEach(c => {
							const opt = document.createElement('option');
							opt.value = c.code;
							opt.textContent = c.label ? `${c.code} ‚Äì ${c.label}` : c.code;
							classeSelect.appendChild(opt);
						});
					})
					.catch(() => {
						// En cas d'erreur, on laisse le select vide avec l'option par d√©faut
					});
			}
		});
	</script>
</body>
</html>
